{"ast":null,"code":"import _objectSpread from\"/Users/hcmhoh02hhul217/Documents/web/webapp-tada/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{useParams}from\"react-router-dom\";import\"./NewsDetail.css\";import sharingIcon from\"../components/assets/icons/sharing.png\";import backIcon from\"../components/assets/icons/back.png\";import socialIcon from\"../components/assets/icons/social.png\";import{ReloadSkeleton,PreloadImage}from\"../components/waiting\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function NewsDetail(){const{id}=useParams();const[news,setNews]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[userData,setUserData]=useState(null);const apiKey=\"oqKbBxKcEn9l4IXE4EqS2sgNzXPFvE\";useEffect(()=>{const fetchNewsDetail=async()=>{const cachedUserData=sessionStorage.getItem(\"userData\");if(cachedUserData){setUserData(JSON.parse(cachedUserData));}else{console.error(\"No user data found in sessionStorage!\");return;}try{const response=await fetch(\"http://admin.tducoin.com/api/news/\".concat(id),{method:\"GET\",headers:{\"x-api-key\":apiKey,\"Content-Type\":\"application/json\"}});if(!response.ok){throw new Error(\"Không thể lấy dữ liệu\");}const data=await response.json();if(data&&data.data){setNews(data.data);}else{setError(\"Không tìm thấy bài viết\");}}catch(error){setError(error.message);}finally{setLoading(false);}};fetchNewsDetail();},[id]);useEffect(()=>{const markAsRead=async()=>{if(!userData||!userData.news_reads||!id){console.error(\"Thiếu dữ liệu user hoặc ID bản tin\");return;}const hasRead=userData.news_reads.some(read=>read.news_id===parseInt(id,10));if(hasRead){console.log(\"User đã đọc bản tin này\");return;}try{const response=await fetch(\"http://admin.tducoin.com/api/addbonus/news-read\",{method:\"POST\",headers:{\"x-api-key\":apiKey,\"Content-Type\":\"application/json\"},body:JSON.stringify({user_id:userData.userID,news_id:id})});if(!response.ok){throw new Error(\"Không thể ghi nhận bản tin đã đọc\");}const result=await response.json();if(result.success){const updatedUserData=_objectSpread(_objectSpread({},userData),{},{news_reads:[...userData.news_reads,{news_id:parseInt(id,10)}],wallet_AC:result.wallet_AC});setUserData(updatedUserData);sessionStorage.setItem(\"userData\",JSON.stringify(updatedUserData));}else{console.error(\"Lỗi cộng điểm:\",result.message);}}catch(error){console.error(\"Error marking news as read:\",error.message);}};markAsRead();},[id,userData]);if(loading){return/*#__PURE__*/_jsx(ReloadSkeleton,{});}if(error){return/*#__PURE__*/_jsx(\"div\",{children:error});}if(!news){return/*#__PURE__*/_jsx(\"div\",{children:\"Kh\\xF4ng t\\xECm th\\u1EA5y b\\xE0i vi\\u1EBFt\"});}const BASE_URL=\"http://admin.tducoin.com/public/storage/\";const picUrl=\"\".concat(BASE_URL).concat(news.banner);const telegramShareUrl=\"https://t.me/share/url?url=\".concat(encodeURIComponent(window.location.href),\"&text=\").concat(encodeURIComponent(news.title));const telegramChannelUrl=\"https://t.me/tadaup\";return/*#__PURE__*/_jsxs(\"div\",{className:\"news-detail-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"banner-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"backIcon\",onClick:()=>window.history.back(),children:/*#__PURE__*/_jsx(\"img\",{src:backIcon,alt:\"Back Icon\",className:\"backIconImage\"})}),/*#__PURE__*/_jsx(PreloadImage,{src:picUrl,alt:\"Banner\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"news-detail-content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:news.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"name-time-container\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"name-time\",children:[news.name,\" - \",news.time]}),/*#__PURE__*/_jsx(\"div\",{className:\"share-icon-news\",children:/*#__PURE__*/_jsxs(\"a\",{href:telegramShareUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"share-link\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Chia s\\u1EBB\"}),/*#__PURE__*/_jsx(\"img\",{src:sharingIcon,alt:\"Share Icon\",className:\"share-icon\"})]})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"content-news\",children:news.description}),/*#__PURE__*/_jsx(\"div\",{className:\"telegram-channel-link\",children:/*#__PURE__*/_jsxs(\"a\",{href:telegramChannelUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"go-to-telegram-button\",children:[/*#__PURE__*/_jsx(\"img\",{src:socialIcon,alt:\"Social Icon\",className:\"social-icon\"}),\" K\\xEAnh tha\\u0309o lu\\xE2\\u0323n\"]})})]})]});}export default NewsDetail;","map":{"version":3,"names":["React","useState","useEffect","useParams","sharingIcon","backIcon","socialIcon","ReloadSkeleton","PreloadImage","jsx","_jsx","jsxs","_jsxs","NewsDetail","id","news","setNews","loading","setLoading","error","setError","userData","setUserData","apiKey","fetchNewsDetail","cachedUserData","sessionStorage","getItem","JSON","parse","console","response","fetch","concat","method","headers","ok","Error","data","json","message","markAsRead","news_reads","hasRead","some","read","news_id","parseInt","log","body","stringify","user_id","userID","result","success","updatedUserData","_objectSpread","wallet_AC","setItem","children","BASE_URL","picUrl","banner","telegramShareUrl","encodeURIComponent","window","location","href","title","telegramChannelUrl","className","onClick","history","back","src","alt","name","time","target","rel","description"],"sources":["/Users/hcmhoh02hhul217/Documents/web/webapp-tada/src/pages/NewsDetail.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport \"./NewsDetail.css\";\nimport sharingIcon from \"../components/assets/icons/sharing.png\";\nimport backIcon from \"../components/assets/icons/back.png\";\nimport socialIcon from \"../components/assets/icons/social.png\";\nimport { ReloadSkeleton, PreloadImage } from \"../components/waiting\";\n\nfunction NewsDetail() {\n  const { id } = useParams();\n\n  const [news, setNews] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [userData, setUserData] = useState(null);\n\n  const apiKey = \"oqKbBxKcEn9l4IXE4EqS2sgNzXPFvE\";\n\n  useEffect(() => {\n    const fetchNewsDetail = async () => {\n      const cachedUserData = sessionStorage.getItem(\"userData\");\n      if (cachedUserData) {\n        setUserData(JSON.parse(cachedUserData));\n      } else {\n        console.error(\"No user data found in sessionStorage!\");\n        return;\n      }\n\n      try {\n        const response = await fetch(`http://admin.tducoin.com/api/news/${id}`, {\n          method: \"GET\",\n          headers: {\n            \"x-api-key\": apiKey,\n            \"Content-Type\": \"application/json\",\n          },\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Không thể lấy dữ liệu\");\n        }\n\n        const data = await response.json();\n        if (data && data.data) {\n          setNews(data.data);\n        } else {\n          setError(\"Không tìm thấy bài viết\");\n        }\n      } catch (error) {\n        setError(error.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchNewsDetail();\n  }, [id]);\n\n  useEffect(() => {\n    const markAsRead = async () => {\n      if (!userData || !userData.news_reads || !id) {\n        console.error(\"Thiếu dữ liệu user hoặc ID bản tin\");\n        return;\n      }\n\n      const hasRead = userData.news_reads.some((read) => read.news_id === parseInt(id, 10));\n\n      if (hasRead) {\n        console.log(\"User đã đọc bản tin này\");\n        return;\n      }\n\n      try {\n        const response = await fetch(\"http://admin.tducoin.com/api/addbonus/news-read\", {\n          method: \"POST\",\n          headers: {\n            \"x-api-key\": apiKey,\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            user_id: userData.userID,\n            news_id: id,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Không thể ghi nhận bản tin đã đọc\");\n        }\n\n        const result = await response.json();\n\n        if (result.success) {\n          const updatedUserData = {\n            ...userData,\n            news_reads: [...userData.news_reads, { news_id: parseInt(id, 10) }],\n            wallet_AC: result.wallet_AC,\n          };\n          setUserData(updatedUserData);\n          sessionStorage.setItem(\"userData\", JSON.stringify(updatedUserData));\n        } else {\n          console.error(\"Lỗi cộng điểm:\", result.message);\n        }\n      } catch (error) {\n        console.error(\"Error marking news as read:\", error.message);\n      }\n    };\n\n    markAsRead();\n  }, [id, userData]);\n\n  if (loading) {\n    return <ReloadSkeleton />;\n  }\n\n  if (error) {\n    return <div>{error}</div>;\n  }\n\n  if (!news) {\n    return <div>Không tìm thấy bài viết</div>;\n  }\n\n  const BASE_URL = \"http://admin.tducoin.com/public/storage/\";\n  const picUrl = `${BASE_URL}${news.banner}`;\n  const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(news.title)}`;\n  const telegramChannelUrl = \"https://t.me/tadaup\";\n\n  return (\n    <div className=\"news-detail-container\">\n      <div className=\"banner-header\">\n        <button className=\"backIcon\" onClick={() => window.history.back()}>\n          <img src={backIcon} alt=\"Back Icon\" className=\"backIconImage\" />\n        </button>\n        <PreloadImage\n          src={picUrl}\n          alt=\"Banner\"\n        />\n      </div>\n      <div className=\"news-detail-content\">\n        <h2>{news.title}</h2>\n        <div className=\"name-time-container\">\n          <p className=\"name-time\">\n            {news.name} - {news.time}\n          </p>\n          <div className=\"share-icon-news\">\n            <a href={telegramShareUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"share-link\">\n              <span>Chia sẻ</span>\n              <img src={sharingIcon} alt=\"Share Icon\" className=\"share-icon\" />\n            </a>\n          </div>\n        </div>\n        <p className=\"content-news\">{news.description}</p>\n        <div className=\"telegram-channel-link\">\n          <a href={telegramChannelUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"go-to-telegram-button\">\n            <img src={socialIcon} alt=\"Social Icon\" className=\"social-icon\" /> Kênh thảo luận\n          </a>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default NewsDetail;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}